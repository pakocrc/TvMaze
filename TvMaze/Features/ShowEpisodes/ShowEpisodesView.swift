//
//  ShowEpisodesView.swift
//  TvMaze
//
//  Created by Francisco Cordoba on 18/4/25.
//

import SwiftUI

struct ShowEpisodesView: View {
    @StateObject var viewModel: ShowEpisodesViewModel

    var body: some View {
        List {
            ForEach(viewModel.seasonEpisodes) { seasonEpisodes in
                Section("Season \(seasonEpisodes.season.number ?? 0)") {
                    if seasonEpisodes.episodes.isEmpty {
                        Text("N/A")
                    } else {
                        ForEach(seasonEpisodes.episodes, id: \.id) { episode in
                                HStack {
                                    Text("\(episode.number ?? 0).")
                                    Text(episode.name ?? "")
                                }
                                .onTapGesture {
                                    viewModel.selectedEpisode = episode
                                }
                        }
                    }
                }
            }
        }
        .navigationTitle("\(viewModel.tvShow.name ?? "") Seasons")
        .navigationDestination(item: $viewModel.selectedEpisode) { episode in
            EpisodeDetailsView(viewModel: EpisodeDetailsViewModel(episode: episode))
        }
    }
}

#Preview {
    ShowEpisodesView(viewModel: ShowEpisodesViewModel(tvShow: TvMazeStore.shared.getTvShow(),
                                                      seasons: [TvMaze.TvMazeSeason(id: 141, url: Optional("https://www.tvmaze.com/seasons/141/outlander-season-1"), number: Optional(1), name: Optional(""), episodeOrder: Optional(16), premiereDate: Optional("2014-08-09"), endDate: Optional("2015-05-30"), network: TvMaze.TvMazeNetwork(id: Optional(17), name: Optional("STARZ"), officialSite: Optional("https://www.starz.com/us/en/")), image: Optional(TvMaze.TvMazeImage(medium: "https://static.tvmaze.com/uploads/images/medium_portrait/10/26525.jpg", original: "https://static.tvmaze.com/uploads/images/original_untouched/10/26525.jpg")), summary: Optional("<p>Book One sees Claire Randall, a married combat nurse from 1945, mysteriously swept back in time to 1743. Upon her arrival, she is immediately thrown into an unknown world where her life is threatened. But when she is forced to marry Jamie Fraser, a chivalrous and romantic young Scottish warrior, a passionate relationship is ignited. Now, Claire\'s heart is torn between two vastly different men in two irreconcilable lives.</p>")), TvMaze.TvMazeSeason(id: 35254, url: Optional("https://www.tvmaze.com/seasons/35254/outlander-season-2"), number: Optional(2), name: Optional(""), episodeOrder: Optional(13), premiereDate: Optional("2016-04-09"), endDate: Optional("2016-07-09"), network: TvMaze.TvMazeNetwork(id: Optional(17), name: Optional("STARZ"), officialSite: Optional("https://www.starz.com/us/en/")), image: Optional(TvMaze.TvMazeImage(medium: "https://static.tvmaze.com/uploads/images/medium_portrait/223/558329.jpg", original: "https://static.tvmaze.com/uploads/images/original_untouched/223/558329.jpg")), summary: Optional("<p>Season 2 begins as Claire and Jamie arrives in France, hell-bent on infiltrating the Jacobite rebellion and stopping the battle of Culloden. Thrown into the lavish world of French society, where intrigue and parties are abundant, Jamie and Claire struggle to advance their political agenda. They must race to prevent a doomed Highland uprising, and the extinction of Scottish life.</p>")), TvMaze.TvMazeSeason(id: 61925, url: Optional("https://www.tvmaze.com/seasons/61925/outlander-season-3"), number: Optional(3), name: Optional(""), episodeOrder: Optional(13), premiereDate: Optional("2017-09-10"), endDate: Optional("2017-12-10"), network: TvMaze.TvMazeNetwork(id: Optional(17), name: Optional("STARZ"), officialSite: Optional("https://www.starz.com/us/en/")), image: Optional(TvMaze.TvMazeImage(medium: "https://static.tvmaze.com/uploads/images/medium_portrait/223/558330.jpg", original: "https://static.tvmaze.com/uploads/images/original_untouched/223/558330.jpg")), summary: Optional("<p>Separated by continents and centuries, Claire and Jamie must find their way back to each other. As always, adversity, mystery, and adventure await them on the path to reunion. And the question remains: When they find each other, will they be the same people who parted at the standing stones, all those years ago?</p>")), TvMaze.TvMazeSeason(id: 76585, url: Optional("https://www.tvmaze.com/seasons/76585/outlander-season-4"), number: Optional(4), name: Optional(""), episodeOrder: Optional(13), premiereDate: Optional("2018-11-04"), endDate: Optional("2019-01-27"), network: TvMaze.TvMazeNetwork(id: Optional(17), name: Optional("STARZ"), officialSite: Optional("https://www.starz.com/us/en/")), image: Optional(TvMaze.TvMazeImage(medium: "https://static.tvmaze.com/uploads/images/medium_portrait/223/558331.jpg", original: "https://static.tvmaze.com/uploads/images/original_untouched/223/558331.jpg")), summary: Optional("<p>Season 4 picks up from where Season 3 ended and will draw from the novel <i>Drums of Autumn</i>, in which the time-traveling 20th century doctor Claire and her 18th century Highlander husband Jamie try to make a home for themselves in colonial America. Along the way, the Frasers cross paths with notorious pirate and smuggler Stephen Bonnet in a fateful meeting that will come back to haunt the Fraser family.</p>")), TvMaze.TvMazeSeason(id: 84934, url: Optional("https://www.tvmaze.com/seasons/84934/outlander-season-5"), number: Optional(5), name: Optional(""), episodeOrder: Optional(12), premiereDate: Optional("2020-02-16"), endDate: Optional("2020-05-10"), network: TvMaze.TvMazeNetwork(id: Optional(17), name: Optional("STARZ"), officialSite: Optional("https://www.starz.com/us/en/")), image: Optional(TvMaze.TvMazeImage(medium: "https://static.tvmaze.com/uploads/images/medium_portrait/256/640176.jpg", original: "https://static.tvmaze.com/uploads/images/original_untouched/256/640176.jpg")), summary: Optional("<p>Book Five finds the Frasers fighting for their family and the home they have forged on Fraser\'s Ridge. Jamie must find a way to defend all that he has created in America, while hiding his personal relationship with Murtagh Fitzgibbons, the man whom Governor William Tryon has ordered him to hunt down and kill. With her family together at last, Claire Fraser must use her modern medical knowledge and foresight to prevent them from being ripped apart once again.</p>")), TvMaze.TvMazeSeason(id: 84935, url: Optional("https://www.tvmaze.com/seasons/84935/outlander-season-6"), number: Optional(6), name: Optional(""), episodeOrder: Optional(8), premiereDate: Optional("2022-03-06"), endDate: Optional("2022-05-01"), network: TvMaze.TvMazeNetwork(id: Optional(17), name: Optional("STARZ"), officialSite: Optional("https://www.starz.com/us/en/")), image: Optional(TvMaze.TvMazeImage(medium: "https://static.tvmaze.com/uploads/images/medium_portrait/398/996801.jpg", original: "https://static.tvmaze.com/uploads/images/original_untouched/398/996801.jpg")), summary: Optional("<p>The sixth season of \"Outlander\" sees a continuation of Claire and Jamie\'s fight to protect those they love, as they navigate the trials and tribulations of life in colonial America.</p>")), TvMaze.TvMazeSeason(id: 121514, url: Optional("https://www.tvmaze.com/seasons/121514/outlander-season-7"), number: Optional(7), name: Optional(""), episodeOrder: Optional(16), premiereDate: Optional("2023-06-16"), endDate: Optional("2025-01-17"), network: TvMaze.TvMazeNetwork(id: Optional(17), name: Optional("STARZ"), officialSite: Optional("https://www.starz.com/us/en/")), image: Optional(TvMaze.TvMazeImage(medium: "https://static.tvmaze.com/uploads/images/medium_portrait/436/1091442.jpg", original: "https://static.tvmaze.com/uploads/images/original_untouched/436/1091442.jpg")), summary: Optional("<p>Season seven picks up from the harrowing events of the end of season six, with Jamie and Young Ian racing to rescue Claire before she\'s tried and wrongfully convicted for the murder of Malva Christie. But their mission is complicated by the beginning of a geopolitical firestorm: The American Revolution has arrived. In the seventh season of <i>Outlander</i> Jamie, Claire, and their family are caught in the violent birth pains of an emerging nation as armies march to war and British institutions crumble in the face of armed rebellion. The land the Frasers call home is changing - and they must change with it. In order to protect what they\'ve built, the Frasers have to navigate the perils of the Revolutionary War. They learn that sometimes to defend what you love, you have to leave it behind. As the conflict draws them out of North Carolina and into the heart of this fight for independence, Jamie, Claire, Brianna, and Roger are faced with impossible decisions that have the potential to tear their family apart.</p>")), TvMaze.TvMazeSeason(id: 147933, url: Optional("https://www.tvmaze.com/seasons/147933/outlander-season-8"), number: Optional(8), name: Optional(""), episodeOrder: Optional(10), premiereDate: nil, endDate: nil, network: TvMaze.TvMazeNetwork(id: Optional(17), name: Optional("STARZ"), officialSite: Optional("https://www.starz.com/us/en/")), image: Optional(TvMaze.TvMazeImage(medium: "https://static.tvmaze.com/uploads/images/medium_portrait/465/1163287.jpg", original: "https://static.tvmaze.com/uploads/images/original_untouched/465/1163287.jpg")), summary: nil)]))
}
